---
import Layout from '../layouts/Dashboard.astro';
import { getAllRelinner } from '../lib/api.js';
import { getAllRel } from '../lib/api.js';
import MusicList from '../components/MusicList.astro';
import { getSanityImageURL, formatBlogPostDate } from '../utils/helpers.js'
export interface Props {
  music: any;
  innerText: any;
}

// const art = await getAllRel();
// const { slug } = Astro.params;
// const arts = art.find((art) => art.slug.current === slug);
// if (!arts) return Astro.redirect("/404");
// const { music, title, downloadmp3 } = arts;


export async function getStaticPaths() {
  const musics = await getAllRelinner();
  const paths = musics.map((music) => ({
    params: { slug: music.slug.current },
  }));
  return { paths, fallback: false };
}

export async function getStaticProps({ params }) {
  const music = await getAllRel(params.slug);
  return { props: { music } };
}

const { music } = Astro.props;



// export async function getStaticPaths() {
//     const allBlogPosts = await getAllRel();
//     return allBlogPosts.map((music: any) => ({
//         params: { slug: music.slug.current },
//         props: { music, },
//     }));
// }

// const { music } = Astro.props;

// const { music, innerText } = Astro.props;
// const blogPostBody = await convertBlockContentToMarkdown(post.bodyRaw);
// export async function getStaticPaths() {
//   const allMusicInfo = await getAllRel();
//   return allMusicInfo.map(music => ({ params: { slug: music.slug.current }, props: { music } }));
// }

// export async function getStaticProps({ params }) {
//   const { slug } = params;
//   const music = await getAllRels().find((m) => m.slug.current === slug);

//   if (!music) {
//     return {
//       notFound: true,
//     };
//   }

//   return {
//     props: {
//       music,
//     },
//   };
// }

const seo = {
  title: 'as',
  description: 's' ,
}
---
<Layout seo={seo}>
  <div class="dashboard-nav-main-container">
    <div class="container-default w-container">
        <div class="dashboard-nav-container">
            <div class="dashboard-nav-left-content">
                <div class="mg-right-24px">
                    <div class="text-400 medium color-neutral-800">

                      {getAllRels.map((music) =>
                      
                      <div class="color-neutral-800">
                      {music.title}
                    </div>
                    )}</div>
      
      
                </div>

            </div>
            <div class="dashboard-nav-right-content">


                <div data-hover="true" data-w-id="b5a11493-9e48-7ef8-19ef-456f41cdbd81" class="dropdown-wrapper w-dropdown" data-delay="0">
                    <div class="dropdown-toggle w-dropdown-toggle" id="w-dropdown-toggle-8" aria-controls="w-dropdown-list-8" aria-haspopup="menu" aria-expanded="false" role="button" tabindex="0"><img src="./img/dashboard.png" loading="eager" alt="John Carter - Dashly X Webflow Template" class="avatar-circle _02 mg-right-8px">
                        <div class="hidden-on-mbl">
                            <div class="mg-bottom-4px">
                                <div class="text-200 medium color-neutral-800" style="color: rgb(11, 14, 44);">John Carter</div>
                            </div>
                            <div class="text-100 medium color-neutral-600">Account settings</div>
                        </div>
                        <div class="line-rounded-icon dropdown-arrow profile-dropdown" style="transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg); transform-style: preserve-3d; color: rgb(152, 154, 173);"><i class="bx bx-chevron-down"></i></div>
                    </div>
                    <nav class="dropdown-column-wrapper dashboard-nav-profile w-dropdown-list" style="display: none; opacity: 0; transform: translate3d(-73%, 10px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg); transform-style: preserve-3d; width: 202px; height: 0px;"
                        id="w-dropdown-list-8" aria-labelledby="w-dropdown-toggle-8">
                        <div>
                            <div>
                                <a href="/profiles/v1" class="dashboard-profile-dropdown-link-wrapper w-inline-block" tabindex="0">
                                    <div class="dashly-custom-icon dashboard-nav-profile-icon"></div>
                                    <div class="text-200 medium">View profile</div>
                                </a>
                                <a href="/settings/v1" class="dashboard-profile-dropdown-link-wrapper w-inline-block" tabindex="0">
                                    <div class="dashly-custom-icon dashboard-nav-profile-icon"></div>
                                    <div class="text-200 medium">Settings</div>
                                </a>
                                <a href="/utility-pages/notifications" class="dashboard-profile-dropdown-link-wrapper mg-bottom-0 w-inline-block" tabindex="0">
                                    <div class="dashly-custom-icon dashboard-nav-profile-icon"></div>
                                    <div class="text-200 medium">Notifications</div>
                                </a>
                                <div class="divider _20px"></div>
                                <a href="/help-center/help-center" class="dashboard-profile-dropdown-link-wrapper w-inline-block" tabindex="0">
                                    <div class="dashly-custom-icon dashboard-nav-profile-icon"></div>
                                    <div class="text-200 medium">Help center</div>
                                </a>
                                <a href="/features/support" class="dashboard-profile-dropdown-link-wrapper w-inline-block" tabindex="0">
                                    <div class="dashly-custom-icon dashboard-nav-profile-icon"></div>
                                    <div class="text-200 medium">Support</div>
                                </a>
                                <a data-w-id="b5a11493-9e48-7ef8-19ef-456f41cdbda9" href="/utility-pages/log-in" class="dashboard-profile-dropdown-link-wrapper transition-none w-inline-block" tabindex="0">
                                    <div class="dashly-custom-icon dashboard-nav-profile-icon color-secondary-8"></div>
                                    <div class="text-200 medium color-secondary-8">Log out</div>
                                </a>
                            </div>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="dashboard-main-content">
    <div class="container-default w-container">
        <div data-w-id="91243996-f3e7-6212-7e17-a5f0993fd94c" style="opacity: 1;" class="mg-bottom-32px">
            <div class="grid-2-columns">
                <div id="w-node-_91243996-f3e7-6212-7e17-a5f0993fd94e-ca9d863e" class="flex align-center children-wrap">
                    <div class="text-400 medium">Группы</div>
                    <div class="line-rounded-icon breadcrumb-divider"><i class='bx bx-chevron-right'></i></div>
                    <div class="text-400 bold color-neutral-800">{getAllRels.map((music) =><a class="text-400 medium color-neutral-800" style="text-decoration: none;" href={`${music.slug.current}`}>
                                      {music.title}
                      </a>
                      )}</div>


                </div>
                <div id="w-node-_932d2677-0544-0771-3519-962dbc05f149-ca9d863e" class="flex vertical-mbp gap-16px">
                    <!-- <div data-w-id="eeec6a21-7ff1-1c06-4ec8-81f509a7af77" class="display-inline-block"><a href="#" class="btn-secondary w-button"><span class="dashly-custom-icon link-icon-left rotate-180deg"></span>Upload file</a>
                        <div style="opacity: 0;" class="popup-wrapper">
                            <div class="popup popup-icon-top" style="transform: translate3d(0px, 0px, 0px) scale3d(0.6, 0.6, 1.01) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg); transform-style: preserve-3d;"><img src="../6260849a6eab2a733e282630/6262b7725cabe019a03a4dfa_success-message-popup-icon-dashboardly-webflow-template.svg" loading="eager" alt="" class="popup-top-icon">
                                <div class="display-4 mg-bottom-8px">Your file has been uploaded<br></div>
                                <div class="mg-bottom-16px">Sit in tincidunt semper vestibulum semper etiam sedol elit id in fermentum quam blandit quis amet.</div><a id="w-node-eeec6a21-7ff1-1c06-4ec8-81f509a7af81-ca9d863e" data-w-id="eeec6a21-7ff1-1c06-4ec8-81f509a7af81"
                                    href="#" class="btn-secondary w-button">Dismiss</a>
                                <div data-w-id="eeec6a21-7ff1-1c06-4ec8-81f509a7af83" class="close-button-popup-module"></div>
                            </div>
                        </div>
                    </div> -->

                    {getAllRels.map((music) =>
                    <div data-w-id="d1b55e49-7d13-d87c-452b-0464c1760e5d" class="display-inline-block"><a id="w-node-d1b55e49-7d13-d87c-452b-0464c1760e5e-ca9d863e" href={music.downloadmp3} class="btn-primary w-button"><span class="line-rounded-icon link-icon-left"><i class='bx bx-upload' ></i></span>Отправить работу</a>
                    </div>
                    )}
                </div>
            </div>
        </div>

        <div data-w-id="5e151d76-f2d6-82ba-f344-3744a7cf7cf6" style="opacity: 1;" class="mg-bottom-24px">
            <div class="module border-radius-30px overflow-hidden">
                <div class="file-manager-table-row header">
                    <div class="flex align-center">

                        <div class="flex align-center cursor-pointer">
                            <div class="text-100 medium text-uppercase">Имя</div>
                            <div class="dashly-custom-icon table-sort-icon"><i class='bx bx-caret-down'></i></div>
                        </div>
                    </div>
                    <div class="flex align-center cursor-pointer">
                        <div class="text-100 medium text-uppercase">Тема</div>
                        <div class="dashly-custom-icon table-sort-icon"><i class='bx bx-caret-down'></i></div>
                    </div>
                    <div class="flex align-center cursor-pointer">
                        <div class="text-100 medium text-uppercase">Дата задания</div>
                        <div class="dashly-custom-icon table-sort-icon"><i class='bx bx-caret-down'></i></div>
                    </div>
                    <div class="flex align-center cursor-pointer">
                        <div class="text-100 medium text-uppercase">Тип файла</div>
                        <div class="dashly-custom-icon table-sort-icon"><i class='bx bx-caret-down'></i></div>
                    </div>
                </div>

                <!-- <MusicList music={getAllRels}/> -->



                {music.tracklist.map((track) => {
                  if (track.manuscript && track.manuscript.asset) {
                    const fileRef = track.manuscript.asset._ref.replace('file-', '');
                    const lastDashIndex = fileRef.lastIndexOf("-");
                    const fileExtension = fileRef.substring(lastDashIndex + 1);
                    const formattedFileRef = `${fileRef.substring(0, lastDashIndex)}.${fileExtension}`;
                    const fileUrl = `https://cdn.sanity.io/files/2xd7irb9/production/${formattedFileRef}`;
                    return (
                <div class="file-manager-table-row">
                  <div id="w-node-_694f3f70-19c5-1b7b-827a-6cea25fe3635-ca9d863e" class="table-item">
                      <div class="table-item-mobile-caption">
                          <div class="text-100 medium text-uppercase">Имя</div>
                      </div>
                      <div class="flex align-center">
                          
                          <div class="flex align-center">
                              <div class="text-200 medium color-neutral-800">{track.number}</div>
                          </div>
                      </div>
                  </div>
                  <div id="w-node-_694f3f70-19c5-1b7b-827a-6cea25fe364a-ca9d863e" class="table-item">
                      <div class="table-item-mobile-caption">
                          <div class="text-100 medium text-uppercase">Тема</div>
                      </div>
                      <div id="w-node-_694f3f70-19c5-1b7b-827a-6cea25fe364e-ca9d863e" class="text-200">{track.duration}</div>
                  </div>
                  <div id="w-node-_694f3f70-19c5-1b7b-827a-6cea25fe3650-ca9d863e" class="table-item">
                      <div class="table-item-mobile-caption">
                          <div class="text-100 medium text-uppercase">Дата задания</div>
                      </div>
                      <div id="w-node-_694f3f70-19c5-1b7b-827a-6cea25fe3654-ca9d863e" class="text-200">{formatBlogPostDate(track.released)}</div>
                  </div>
                  <div id="w-node-_694f3f70-19c5-1b7b-827a-6cea25fe3656-ca9d863e" class="table-item">
                      <div class="table-item-mobile-caption">
                          <div class="text-100 medium text-uppercase">Тип файла</div>
                      </div>
                      <div id="w-node-_694f3f70-19c5-1b7b-827a-6cea25fe365a-ca9d863e" style=" text-transform: uppercase;" class="text-200">{fileExtension}</div>
                  </div>
                  <div id="w-node-a61542d2-58a0-9095-449b-3ba12e3a4293-ca9d863e" class="table-item last">
                      <div class="table-item-mobile-caption">
                          <div class="text-100 medium text-uppercase">Действия</div>
                      </div>
                      <div class="">
                        <a href={fileUrl} target="_blank" download class="btn-secondary small w-button"><span class="line-rounded-icon link-icon-left"><i class='bx bxs-download'></i></span>Скачать</a>
                      </div>
                  </div>
              </div>

                    );
                  } else {
                    return (
                      <li key={track._key}>
                        <span>{track.number}</span>
                        <span>{track.duration}</span>
                      </li>
                    );
                  }
                })}
            </div>
        </div>

    </div>
</div>
<div data-w-id="297d8ad8-db4a-3ae2-197c-704798a15c49" class="dashboard-footer-wrapper" style="opacity: 1;">
    <div class="container-default w-container">
        <div class="dashboard-footer-inner-wrapper">
            <div>Сайт разработан: <a target="_blank" href="https://vk.com/createandchoose">Aytal Popov</a> - из <a target="_blank" href="https://simbios.agency">Simbios | Digital Agency</a></div>
        </div>
    </div>
</div>


</Layout>


<style>

</style>